# AWS Messaging System with EC2, SQS, and SNS

This project deploys a complete messaging system using AWS CloudFormation, demonstrating the integration of EC2 instances with SQS queues and SNS topics. The system implements a producer-consumer pattern where one EC2 instance generates messages, and another processes them and forwards them to subscribers via SNS.

## Architecture Overview

The system consists of the following components:

- **Custom VPC** with a public subnet and internet access
- **SQS Queue** for message buffering and asynchronous processing
- **SNS Topic** with email subscription for notifications
- **Two EC2 instances**:
  - Producer EC2: Sends messages to the SQS queue every 30 seconds
  - Consumer EC2: Receives messages from SQS, processes them, and publishes to SNS
- **IAM Roles** with least privilege permissions for EC2 instances

## Project Structure

```
.
├── README.md           # This documentation file
└── template.yaml       # CloudFormation template defining the infrastructure
```

## Prerequisites

1. AWS CLI installed and configured
2. Valid AWS credentials with appropriate permissions
3. An email address for SNS notifications
4. Basic understanding of AWS services (EC2, SQS, SNS)
5. SSH key pair in your AWS account (for EC2 access)

## Deployment Instructions

1. Clone this repository:
   ```bash
   git clone <repository-url>
   cd Proyecto-SQS-SNS
   ```

2. Create an SSH key pair in AWS (if you don't have one):
   ```bash
   aws ec2 create-key-pair --key-name messaging-key --query 'KeyMaterial' --output text > messaging-key.pem
   chmod 400 messaging-key.pem
   ```

3. Deploy the CloudFormation stack:
   ```bash
   aws cloudformation create-stack \
     --stack-name messaging-system \
     --template-body file://template.yaml \
     --capabilities CAPABILITY_IAM \
     --parameters ParameterKey=KeyName,ParameterValue=messaging-key \
                 ParameterKey=EmailSubscription,ParameterValue=your-email@example.com
   ```

4. Wait for stack creation to complete:
   ```bash
   aws cloudformation wait stack-create-complete --stack-name messaging-system
   ```

## Verification Steps

1. **Confirm SNS Subscription**
   - Check your email for the SNS subscription confirmation
   - Click the confirmation link in the email

2. **Verify SQS Queue**
   - Open AWS Console
   - Navigate to SQS service
   - You should see the queue created by CloudFormation
   - Monitor the queue metrics to see messages flowing

3. **Monitor EC2 Instances**
   - Navigate to EC2 service in AWS Console
   - Verify both instances are running
   - Check instance logs in CloudWatch for any errors

4. **Verify Message Flow**
   - You should start receiving emails with messages
   - Each email represents a message that was:
     1. Generated by the producer
     2. Sent to SQS
     3. Processed by the consumer
     4. Published to SNS

## Security Considerations

1. **Network Security**
   - VPC is configured with minimum required access
   - Security groups restrict traffic to necessary ports only
   - Instances are in a public subnet but with restricted access

2. **IAM Security**
   - EC2 instances use IAM roles with least privilege
   - Producer instance can only send to SQS
   - Consumer instance can only receive from SQS and publish to SNS

3. **Data Security**
   - All AWS API calls use HTTPS
   - Instance-to-service communication is encrypted
   - SNS emails contain no sensitive data

## Cleanup Instructions

To avoid ongoing charges, delete the resources in this order:

1. Delete the CloudFormation stack:
   ```bash
   aws cloudformation delete-stack --stack-name messaging-system
   ```

2. Wait for stack deletion:
   ```bash
   aws cloudformation wait stack-delete-complete --stack-name messaging-system
   ```

3. Delete the SSH key pair (if created for this project):
   ```bash
   aws ec2 delete-key-pair --key-name messaging-key
   rm messaging-key.pem
   ```

## Troubleshooting

1. **No Messages Received**
   - Verify SNS subscription is confirmed
   - Check EC2 instance logs
   - Verify SQS queue is not empty
   - Check IAM roles and permissions

2. **EC2 Instances Not Running**
   - Check CloudFormation stack events for errors
   - Verify VPC and subnet configuration
   - Check security group rules

3. **Deployment Failures**
   - Ensure AWS CLI has correct permissions
   - Verify parameter values are correct
   - Check CloudFormation stack events for specific errors

## Contributing

Feel free to submit issues and enhancement requests!

## License

This project is licensed under the MIT License - see the LICENSE file for details.